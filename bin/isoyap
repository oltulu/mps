#!/bin/bash
YOK='\033[00m'
KIRMIZI='\033[01;31m'
YESIL='\033[01;32m'
sed -i 's/^# *\(tr_TR.UTF-8\)/\1/' /etc/locale.gen
locale-gen
cd /usr/milis/mps
bash derle.sh

chmod +x /usr/milis/mps/bin/mps
chmod +x /usr/milis/mps/bin/paket 
chmod +x /usr/milis/bin/service 
chmod +x /usr/milis/bin/make-ca
chmod +x /usr/milis/bin/update-ca-trust
chmod +x /usr/milis/mps/bin/mpsd.lua
git config --global pull.ff only
ln -s /usr/bin/cc /usr/bin/gcc
cd /usr/milis/ayarlar/servisler
make install
make kur-random

update-ca-certificates --fresh 
mps kur p11-kit 
make-ca -g 
update-ca-trust

cd /
mps gun -GP
mps kur --dosya=/usr/milis/ayarlar/iso/minimal.liste
mps kur --dosya=/usr/milis/ayarlar/iso/xorg.liste
echo -e "${RED}Kurmak istediğiniz masaüstünün başındaki rakamı yazarak enter tuşuna basınız...${NONE}"
select sistem in xfce4 cinnamon mate kde openbox 
do
echo " $sistem masaüstünü seçtiniz"
mps kur --dosya=/usr/milis/ayarlar/iso/$sistem.liste
mps kur --dosya=/usr/milis/ayarlar/iso/ortak.liste

#mps kur enaz-kur
#mps kur xorg-kur
#mps kur $sistem-kur
#mps kur ortak-kur

dracut -N --force --xz --add 'dmsquash-live pollcdrom' --omit systemd /boot/initrd_live `ls /usr/lib/modules`
rm /etc/sysconfig/clock
# saat ayarları
cat > $ROOTDIR/etc/sysconfig/clock << "EOF"
# Begin /etc/sysconfig/clock

UTC=1
TIMEZONE="Turkey"

# Set this to any options you might need to give to hwclock,
# such as machine hardware clock type for Alphas.
CLOCKPARAMS=

# End /etc/sysconfig/clock
EOF

echo ". /etc/profile" > /root/.bashrc
echo "LANG=tr_TR.UTF-8" >> /etc/environment
# aşağıdaki ayarlar X için gerekli
echo "tr" > /root/.Xkbmap
usermod -a -G pulse-access root

rm -f /var/cache/mps/depo/*.kur ; rm -f /tmp/*.log
service fixer 
echo -e "${YESIL}Önce klavyeden ${KIRMIZI}exit${YOK}${YESIL}yazarak mevcut ortamdan şıkış yapın...${YOK}"
echo -e "${YESIL}Şimdi yeni ISO dosyası oluşturmak için ${KIRMIZI}/tmp/isoyap2${YESIL} yazarak  devam ediniz...${YOK}"
exit
done
