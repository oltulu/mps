#!/bin/bash
NONE='\033[00m'
RED='\033[01;31m'
GREEN='\033[01;32m'
cd /usr/milis/mps
bash derle.sh

chmod +x /usr/milis/mps/bin/mps
chmod +x /usr/milis/mps/bin/paket 
chmod +x /usr/milis/bin/service 
chmod +x /usr/milis/bin/make-ca
chmod +x /usr/milis/bin/update-ca-trust
chmod +x /usr/milis/mps/bin/mpsd.lua
git config --global pull.ff only

cd /usr/milis/ayarlar/servisler
make install
make kur-random

update-ca-certificates --fresh 
mps kur p11-kit 
make-ca -g 
update-ca-trust

cd /
mps gun -GP
mps kur --dosya=/usr/milis/ayarlar/iso/minimal.liste
mps kur --dosya=/usr/milis/ayarlar/iso/xorg.liste
echo "${RED}Kurmak istediğiniz masaüstünün başındaki rakamı yazarak enter tuşuna basınız...${NONE}"
select sistem in xfce4 cinnamon mate kde openbox 
do
echo " $sistem masaüstünü seçtiniz"
mps kur --dosya=/usr/milis/ayarlar/iso/$sistem.liste

#mps kur enaz-kur
#mps kur xorg-kur
#mps kur $sistem-kur
#mps kur ortak-kur

dracut -N --force --xz --add 'dmsquash-live pollcdrom' --omit systemd /boot/initrd_live `ls /usr/lib/modules`
rm /etc/sysconfig/clock
# saat ayarları
cat > $ROOTDIR/etc/sysconfig/clock << "EOF"
# Begin /etc/sysconfig/clock

UTC=1
TIMEZONE="Turkey"

# Set this to any options you might need to give to hwclock,
# such as machine hardware clock type for Alphas.
CLOCKPARAMS=

# End /etc/sysconfig/clock
EOF

echo ". /etc/profile" > /root/.bashrc
echo "LANG=tr_TR.UTF-8" >> /etc/environment
# aşağıdaki ayarlar X için gerekli
echo "tr" > /root/.Xkbmap
usermod -a -G pulse-access root

rm -f /var/cache/mps/depo/*.kur ; rm -f /tmp/*.log
service fixer 
echo -e "${GREEN}Önce klavyeden ${RED}ctrl+c ${NONE}${GREEN}tuşlarına basarak mevcut ortamdan şıkış yapın...${NONE}"
echo -e "${GREEN}Şimdi yeni ISO dosyası oluşturmak için ${RED}/tmp/isoyap2${GREEN} yazarak  devam ediniz...${NONE}"
exit
done
